Django==5.1.2
djangorestframework==3.15.2
psycopg2-binary==2.9.9
python-environ==0.4.54
djangorestframework-simplejwt==5.3.1


# cd Documents\github\BarberShopFrontend\BarberShop\backend> 
#   Set-ExecutionPolicy -Scope CurrentUser RemoteSigned -Force
#   py -m venv .venv
#   .\.venv\Scripts\Activate.ps1
#   Test-Path .\manage.py
#   Test-Path .\api\settings.py

# Luego crea la BD en pgAdmin (o con SQL):

# CREATE DATABASE barbershop OWNER postgres;
# -- (opcional dentro de barbershop)
# \c barbershop
# CREATE EXTENSION IF NOT EXISTS btree_gist;

# por si acaso crear un admin:
#   (.venv) python manage.py createsuperuser

# # desde /backend:

# crear .env con:
    # # Postgres
    # PGHOST=127.0.0.1
    # PGPORT=5432
    # PGDATABASE=barbershop
    # PGUSER=postgres
    # PGPASSWORD=admin

    # # Django
    # DJANGO_SECRET_KEY=2(z(tlwldkh))z-k+ty6dp!8ijx&a8g=den+i70y6su%1m_b$_
    # DJANGO_DEBUG=True
    # DJANGO_ALLOWED_HOSTS=*

    # # PgAdmin (opcional)
    # PGADMIN_EMAIL=admin@local.test
    # PGADMIN_PASSWORD=admin123


# # 1) Base de datos
# docker compose up -d db

# # 2) Backend
# source .venv/bin/activate        # o .venv\Scripts\activate en Windows
# python manage.py migrate
# python manage.py runserver 0.0.0.0:8000


# tablas directas en pgAdmin:
# BEGIN;

# -- =========================
# -- Catálogo de roles
# -- =========================
# CREATE TABLE IF NOT EXISTS roles (
#   id_role SMALLSERIAL PRIMARY KEY,
#   role_code TEXT UNIQUE NOT NULL
# );

# -- =========================
# -- BARBERÍAS
# -- =========================
# CREATE TABLE "barberias" (
#   "id_barberias" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
#   "nombre_barberia" TEXT,
#   "direccion" TEXT,
#   "telefono" TEXT,
#   "timezone" TEXT,
#   "slug" TEXT UNIQUE NOT NULL,
#   "portada_url" TEXT,
#   "barberia_active" BOOLEAN DEFAULT TRUE,
#   "created_at" TIMESTAMP DEFAULT now()
# );

# -- =========================
# -- SERVICIOS
# -- =========================
# CREATE TABLE "servicios" (
#   "id_servicio" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
#   "nombre_servicio" TEXT,
#   "description" TEXT,
#   "servicio_active" BOOLEAN DEFAULT TRUE,
#   "created_at" TIMESTAMP DEFAULT now()
# );

# -- =========================
# -- PROFILES (con FK a roles)
# -- =========================
# CREATE TABLE "profiles" (
#   "id_profile" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
#   -- nuevo: FK a catálogo de roles
#   "role_id" SMALLINT NOT NULL REFERENCES roles(id_role),
#   "full_name" TEXT,
#   "phone" TEXT,
#   "avatar_url" TEXT DEFAULT 'URL',
#   "is_active" BOOLEAN DEFAULT TRUE,
#   "created_at" TIMESTAMP DEFAULT now()
# );

# COMMENT ON TABLE "profiles" IS 'Si luego usas auth externo, agrega user_id (uuid) único y referencia desde citas.id_cliente';

# -- =========================
# -- BARBEROS
# -- =========================
# CREATE TABLE "barberos" (
#   "id_barbero" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
#   "id_barberia" BIGINT NOT NULL REFERENCES "barberias" ("id_barberias") ON DELETE CASCADE,
#   "calificacion" NUMERIC(3,2) CHECK ("calificacion" BETWEEN 0 AND 5),
#   "nombre_barbero" TEXT,
#   "foto_url" TEXT,
#   "especialidades" TEXT,
#   "anios_experiencia" INTEGER,
#   "created_at" TIMESTAMP DEFAULT now()
# );

# -- =========================
# -- BARBERÍA_SERVICIOS (catálogo de servicios por barbería)
# -- =========================
# CREATE TABLE "barberia_servicios" (
#   "id_barberia" BIGINT NOT NULL REFERENCES "barberias" ("id_barberias") ON DELETE CASCADE,
#   "id_servicio" BIGINT NOT NULL REFERENCES "servicios" ("id_servicio") ON DELETE CASCADE,
#   "precio_BarbServ" NUMERIC(10,2),
#   "duracion_min" INTEGER,
#   "created_at" TIMESTAMP DEFAULT now(),
#   PRIMARY KEY ("id_barberia", "id_servicio")
# );

# -- =========================
# -- BARBERO_SERVICIOS (qué servicios hace cada barbero)
# -- =========================
# CREATE TABLE "barbero_servicios" (
#   "id_barbero" BIGINT NOT NULL REFERENCES "barberos" ("id_barbero") ON DELETE CASCADE,
#   "id_servicio" BIGINT NOT NULL REFERENCES "servicios" ("id_servicio") ON DELETE CASCADE,
#   "created_at" TIMESTAMP DEFAULT now(),
#   PRIMARY KEY ("id_barbero", "id_servicio")
# );

# -- =========================
# -- HORARIOS BARBERÍA
# -- =========================
# CREATE TABLE "horarios_barberia" (
#   "id_horario" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
#   "id_barberia" BIGINT NOT NULL REFERENCES "barberias" ("id_barberias") ON DELETE CASCADE,
#   "dia_semana" INTEGER NOT NULL CHECK ("dia_semana" BETWEEN 0 AND 6), -- 0=Dom, 6=Sáb
#   "hora_apertura" TIME,
#   "hora_cierre" TIME,
#   "abierto" BOOLEAN DEFAULT TRUE,
#   "created_at" TIMESTAMP DEFAULT now()
# );

# -- =========================
# -- CITAS
# -- =========================
# CREATE TABLE "citas" (
#   "id_cita" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
#   "id_cliente" BIGINT NOT NULL REFERENCES "profiles" ("id_profile") ON DELETE RESTRICT,
#   "id_barbero" BIGINT NOT NULL REFERENCES "barberos" ("id_barbero") ON DELETE RESTRICT,
#   "id_servicio" BIGINT NOT NULL REFERENCES "servicios" ("id_servicio") ON DELETE RESTRICT,
#   "id_barberia" BIGINT NOT NULL REFERENCES "barberias" ("id_barberias") ON DELETE RESTRICT,
#   "inicio" TIMESTAMP NOT NULL,
#   "fin" TIMESTAMP NOT NULL,
#   "estado" TEXT NOT NULL,
#   "notas" TEXT,
#   "creada_por" BIGINT REFERENCES "profiles" ("id_profile") ON DELETE SET NULL,
#   "aprobada_por" BIGINT REFERENCES "barberos" ("id_barbero") ON DELETE SET NULL,
#   "rechazada_por" BIGINT REFERENCES "barberos" ("id_barbero") ON DELETE SET NULL,
#   "motivo_rechazo" TEXT,
#   "created_at" TIMESTAMP DEFAULT now(),
#   CONSTRAINT citas_estado_chk CHECK ("estado" IN ('pendiente','confirmada','rechazada','cancelada','completada')),
#   CONSTRAINT citas_fin_gt_inicio_chk CHECK ("fin" > "inicio"),
#   CONSTRAINT citas_motivo_rechazo_chk CHECK ("estado" <> 'rechazada' OR "motivo_rechazo" IS NOT NULL)
# );

# COMMENT ON TABLE "citas" IS 'Regla negocio: fin > inicio; si estado = rechazada entonces motivo_rechazo NOT NULL (validar en app/DB)';

# -- =========================
# -- PAGOS
# -- =========================
# CREATE TABLE "pagos" (
#   "pago_id" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
#   "id_cita" BIGINT NOT NULL REFERENCES "citas" ("id_cita") ON DELETE CASCADE,
#   "monto" NUMERIC(10,2),
#   "estado" TEXT,            -- p.ej. 'pendiente','pagado','fallido','reembolsado'
#   "proveedor" TEXT,         -- p.ej. 'stripe','paypal','oxxo'
#   "referencia_proveedor" TEXT,
#   "created_at" TIMESTAMP DEFAULT now()
# );

# -- =========================
# -- RESEÑAS
# -- =========================
# CREATE TABLE "resena" (
#   "id_resenia" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
#   "id_cita" BIGINT NOT NULL REFERENCES "citas" ("id_cita") ON DELETE CASCADE,
#   "id_barbero" BIGINT NOT NULL REFERENCES "barberos" ("id_barbero") ON DELETE CASCADE,
#   "calificacion" INTEGER CHECK ("calificacion" BETWEEN 1 AND 5),
#   "comentario" TEXT,
#   "created_at" TIMESTAMP DEFAULT now()
# );

# -- =========================
# -- BLOQUEOS DE BARBERO (ausencias/vacaciones)
# -- =========================
# CREATE TABLE "bloqueos_barbero" (
#   "id_bloqueo" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
#   "id_barbero" BIGINT NOT NULL REFERENCES "barberos" ("id_barbero") ON DELETE CASCADE,
#   "inicio" TIMESTAMP NOT NULL,
#   "fin" TIMESTAMP NOT NULL,
#   "motivo" TEXT,
#   "created_at" TIMESTAMP DEFAULT now(),
#   CONSTRAINT bloqueos_fin_gt_inicio_chk CHECK ("fin" > "inicio")
# );

# -- =========================
# -- ÍNDICES SUGERIDOS
# -- =========================
# CREATE INDEX IF NOT EXISTS idx_barberos_barberia_barbero
#   ON "barberos" ("id_barberia", "id_barbero");

# CREATE INDEX IF NOT EXISTS idx_barberos_barberia_calificacion
#   ON "barberos" ("id_barberia", "id_barbero", "calificacion");

# CREATE INDEX IF NOT EXISTS idx_citas_barbero_inicio_fin
#   ON "citas" ("id_barbero", "inicio", "fin");

# CREATE INDEX IF NOT EXISTS idx_citas_cliente_inicio
#   ON "citas" ("id_cliente", "inicio");

# CREATE INDEX IF NOT EXISTS idx_citas_barberia_inicio
#   ON "citas" ("id_barberia", "inicio");

# CREATE INDEX IF NOT EXISTS idx_horarios_barberia_dia
#   ON "horarios_barberia" ("id_barberia", "dia_semana");

# CREATE INDEX IF NOT EXISTS idx_pagos_cita
#   ON "pagos" ("id_cita");

# CREATE INDEX IF NOT EXISTS idx_pagos_estado_created
#   ON "pagos" ("estado", "created_at");
			
# CREATE INDEX IF NOT EXISTS idx_resena_barbero_created
#   ON "resena" ("id_barbero", "created_at");

# CREATE INDEX IF NOT EXISTS idx_bloqueos_barbero_inicio_fin
#   ON "bloqueos_barbero" ("id_barbero", "inicio", "fin");

# CREATE UNIQUE INDEX IF NOT EXISTS idx_barberias_slug
#   ON "barberias"("slug");

# COMMIT;

# hola